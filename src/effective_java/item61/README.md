# Item 61 박싱된 기본 타입보다는 기본 타입을 사용하라

--------------------------------------------

자바의 데이터 타입은 크게 2가지로 나뉨 

1. 기본 타입 : int, double, boolean 등 
2. 참조 타입 : String, List 등 

각각의 기본 타입에는 대응하는 참조 타입이 하나씩 있으며, 이를 박싱된 기본 타입이라고 한다. 

예) int, double, boolean에 대응하는 박싱된 기본 타입은 Integer, Double, Boolean 이다. 

둘 사이에는 ** 분명한 차이가 있으니 ** 어떤 타입을 사용하는지는 상당히 중요하다. 주의해서 선택해야 한다. 

### 기본 타입과 박싱된 기본 타입의 주된 차이 3 가지 

1. 기본 타입은 값만 가지고 있으나, 박싱된 기본 타입은 값에 더해 식별성(identity)이란 속성을 갖는다. 달리 말하면 박싱된 기본 타입의 두 인스턴스는 값이 같아도 서로 다르다고 식별될 수 있다. 
2. 기본 타입의 값은 언제나 유효하나, 박싱된 기본 타입은 유효하지 않은 값, 즉 null을 가질 수 있다. 
3. 기본 타입이 박싱된 기본 타입보다 시간과 메모리 사용면에서 더 효율적이다. 

<hr>


코드 61-1 잘못 구현된 비교자 - 문제를 찾아보자!
``` java
Comparator<Integer> naturalOrder = 
    (i, j) -> (i < j) ? -1 : (i==j ? 0 : 1);
```
같은 객체를 비교하는게 아니라면 ** 박싱된 기본 타입에 == 연산자를 사용하면 오류가 일어난다. 

 
> 실무에서는 기본 타입을 다루는 비교자가 필요하다면 Comparator.naturalOrder()를 사용하자. 

코드 61-2 문제를 수정한 비교자
``` java
Comparator<Integer> naturalOrder = (iBoxed, jBoxed) -> {
    int i = iBoxed, j = jBoxed; // 오토박싱
    return i < j ? -1 : (i==j ? 0 : 1);
);
```

코드 61-3 기이하게 동작하는 프로그램 - 결과를 맞혀보자!
``` java
public class Unbelievable {
    static Integer i;
    
    public static void main(String[] args) {
        if (i == 42)
            System.out.println("믿을 수 없군!");
    }
}
```
"믿을 수 없군"을 출력하지만, i == 42를 검사할 때 NullPointerException을 던지는 것이다. 

* 원인: i가 int가 아닌 Integer, i의 초깃값도 null

>  거의 예외 없이 기본 타입과 박싱된 기본 타입을 혼용한 연산에서는 박싱된 기본 타입의 박싱이 자동으로 풀린다. 그리고 null 참조를 언박싱하면 NullPointerException이 발생한다.

코드 61-4 끔찍이 느리다! 객체가 만들어지는 위치를 찾았는가? - 코드 6-3과 같음
``` java
public static void main(String[] args) {
    Long sum = 0L;
    for (long i = 0; i <= Integer.MAX_VALUE; i++) {
        sum += i;
    }
    System.out.println(sum);
}
```
이 프로그램은 실수로 지역변수 sum을 박싱된 기본 타입으로 선언하여 느려졌다. 

오류나 경고 없이 컴파일되지만, 박싱과 언박싱이 반복해서 일어나 체감될 정도로 성능이 느려진다. 

<hr>

### 박싱된 기본 타입을 사용하는 경우
1. 컬렉션의 원소, 키, 값으로 쓴다. 
컬렉션은 기본 타입을 담을 수 없으므로 어쩔 수 없이 박싱된 기본 타입을 써야만 한다. 매개변수화 타입이나 매개변수화 메서드의 타입 매개변수로는 박싱된 기본타입을 써야 한다.
자바 언어가 타입 매개변수로 기본 타입을 지원하지 않기 때문이다. 
2. 리플렉션을 통해 메서드를 호출할 때도 박싱된 기본 타입을 사용해야 한다. 

<hr>

### 핵심 정리
- 기본 타입과 박싱된 기본 타입 중 하나를 선택해야 한다면 가능하면 기본 타입을 사용하라. 
- 기본 타입은 간단하고 빠르다. 
- 박싱된 기본 타입을 써야 한다면 주의를 기울이자. 
- 오토박싱이 박싱된 기본 타입을 상요할 때의 번거로움을 줄여주니만, 그 위험까지 없애주지는 않는다. 
- 두 박싱된 기본 타입을 == 연산자로 비교한다면 식별성 비교가 이뤄지는데, 이는 여러분이 원한 게 아닐 가능성이 크다. 
- 같은 연산에서 기본 타입과 박싱된 기본 타입을 혼용하면 언박싱이 이뤄지며, 언박싱 과정에서 NullPointerException을 던질 수 있다. 
- 마지막으로, 기본 타입을 박싱하는 작업은 필요 없는 객체를 생성하는 부작용을 나을 수 있다. 