# Item 59 라이브러리를 익히고 사용하라

--------------------------------------------

무작정 정수 하나를 생성하고 싶다고 해보자. 값의 범위는 0부터 명시한 수 사이다. 

코드 59-1 흔하지만 문제가 심각한 코드!
``` java
static Random rnd = new Random();

static int random(int n) {
    return Math.abs(rnd.nextInt()) % n;
}
```

### 문제점 

1. n이 그리 크지 않은 2의 제곱수라면 얼마 지나지 않아 같은 수열이 반복된다. 
2. n이 2의 제곱수가 아니라면 몇몇 숫자가 평균적으로 더 자주 반환된다. 

무작위 수를 백만개 생성한 다음, 그중 중간 값보다 작은 게 몇 개인지를 출력한다.
``` java
public static void main(String[] args) {
    int n = 2 * (Integer.MAX_VALUE / 3);
    int low = 0;
    for (int i = 0; i < 1000000; i++)
        if (random(n) < n/2)
            low++;
    System.out.println(low);
}
```
random메서드가 이상적으로 동작한다면 약 50만개가 출력돼야 하지만, 실제로 돌려보면 666,666에 가까운 값을 얻는다. 

무작위로 생성된 수 중에서 2/3 가량이 중간값보다 낮은 쪽으로 쏠린 것이다. 

<hr>

* random 메서드의 세 번째 결함

지정한 범위 '바깥'의 수가 종종 튀어나올 수 있다. 

rnd.nextInt()가 반환한 값을 Math.abs를 이용해 음수가 아닌 정수로 매핑하기 때문이다. 

nextInt()가 Integer.MIN_VALUE를 반환하면 Math.abs도 Integer.MIN_VALUE를 반환하고, 나머지 연산자(%)는 음수를 반환해버린다.

<hr>

이 결함을 해결하려면 의사난수 생성기, 정수론, 2의 보수 계산 등에 조예가 깊어야 한다. 

다행히 여러분이 직접 해결할 필요는 없다. Random.nextInt(int)가 이미 해결해놨으니 말이다. 

### 표준라이브러리 사용의 장점

> 1. 표준 라이브러리를 사용하면 그 코드를 작성한 전문가의 지식과 여러분보다 앞서 사용한 다른 프로그래머들의 경험을 활용할 수 있다. 

<hr>

* 자바 7부터는 Random을 더 이상 사용하지 않는 게 좋다. ThreadLocalRandom으로 대체하면 대부분 잘 작동한다. 

 Random보다 더 고품질의 무작위 수를 생성할 뿐 아니라 속도도 더 빠르다. 
 
* 포크-조인 풀이나 병렬 스트림에서는 SplittalbeRandom을 사용하라. 

<hr>

> 2. 핵심적인 일과 크게 관련 없는 문제를 해결하느라 시간을 허비하지 않아도 된다는 것이다. 


> 3. 따로 노력하지 않아도 성능이 지속해서 개선된다는 점이다. 

사용자가 많고, 업계 표준 벤치마크를 사용해 성능을 확인하기 때문에 표준 라이브러리 제작자들은 

더 나은 방법을 꾸준히 모색할 수밖에 없다. 자바 플랫폼 라이브러리의 많은 부분이 수 년에 걸쳐 지속해서 다시 작성되며, 

때론 성능이 극적으로 개선되기도 한다. 

> 4. 기능이 점점 많아진다. 

> 5. 여러분이 작성한 코드가 많은 사람에게 낯익은 코드가 된다는 점. 

자연스럽게 다른 개발자들이 더 읽기 좋고, 유지보수하기 좋고, 재활용하기 쉬운 코드가 된다. 



### 도움되는 라이브러리
- 컬렉션 프레임워크
- 스트림 라이브러리
- java.util.concurrent 동시성 기능, 멀티스레드 프로그래밍 작업을 단순화해주는 고수준의 편의기능 제공, 능숙한 개발자가 자신만의 고수준 개념을 직접 구현할 수 있도록 도와주는 저수준 요소들을 제공


### 핵심 정리

- 바퀴를 다시 발명하지 말자. 아주 특별한 나만의 기능이 아니라면 누군가 이미 라이브러리 형태로 구현해놓았을 가능성이 크다.
- 그런 라이브러리가 있다면, 쓰면 된다. 있는지 모르겠다면 찾아보라
- 일반적으로 라이브러리의 코드는 여러분이 직접 작성한 것보다 품질이 좋고, 점차 개선될 가능성이 크다. 
- 코드 품질에도 규모의 경제가 적용된다. 라이브러리 코드는 개발자 각자가 작성하는 것보다 주목을 훨씬 많이 받으므로 코드 품질도 그만큼 높아진다. 
